IF (SWIG_VERSION VERSION_LESS 4.0.0)
	MESSAGE(FATAL_ERROR "For R interface SWIG 4.0.0 or later is required")
ENDIF()

FIND_PACKAGE(R REQUIRED)

UNSET(TARGET_SWIGFLAGS)

include(ShogunInterfaces)
SET(SWIG_CXX_COMPILER_FLAGS "${SWIG_CXX_COMPILER_FLAGS} ${R_CXX_FLAGS}")
IF("${CMAKE_CXX_COMPILER_ID}" STREQUAL "Clang")
	SET(SWIG_CXX_COMPILER_FLAGS "${SWIG_CXX_COMPILER_FLAGS} -DDO_NOT_USE_CXX_HEADERS")
ENDIF()

GENERATE_INTERFACE_TARGET(r ${CMAKE_CURRENT_SOURCE_DIR} ${R_LIBRARIES})
set_target_properties(interface_r PROPERTIES PREFIX "")

EXECUTE_PROCESS(COMMAND ${PYTHON_EXECUTABLE} -c "from time import gmtime, strftime; print(strftime(\"%Y-%m-%d\", gmtime()))"
	OUTPUT_VARIABLE DATE
	OUTPUT_STRIP_TRAILING_WHITESPACE
)

CONFIGURE_FILE(${CMAKE_CURRENT_SOURCE_DIR}/DESCRIPTION.in ${CMAKE_CURRENT_BINARY_DIR}/DESCRIPTION @ONLY)

INSTALL(CODE "EXECUTE_PROCESS(COMMAND ${CMAKE_CURRENT_SOURCE_DIR}/r-install.sh shogun ${CMAKE_SHARED_LIBRARY_SUFFIX} WORKING_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR})")
